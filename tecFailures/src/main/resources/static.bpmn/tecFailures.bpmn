<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_05zbtru" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.37.0" modeler:executionPlatform="Camunda Platform" modeler:executionPlatformVersion="7.21.0">
  <bpmn:collaboration id="Collaboration_0y3poa2">
    <bpmn:participant id="Participant_1xzh7ng" name="Technical Failures Management" processRef="tecFailures" />
  </bpmn:collaboration>
  <bpmn:process id="tecFailures" name="Technical Failures Report" isExecutable="true" camunda:historyTimeToLive="0">
    <bpmn:laneSet id="LaneSet_17evs1j">
      <bpmn:lane id="Lane_1ncb5kn">
        <bpmn:flowNodeRef>Gateway_1b3ega7</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_1b7qy8d</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_066js8m</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_0423gd3</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_1c06mj0</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_1g09bxj</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_10hruzy</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Event_1q1goyy</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_1r12fda">
        <bpmn:flowNodeRef>Activity_193y6v1</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_1ll5x9g</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_0cgi9xw" name="Operator">
        <bpmn:flowNodeRef>StartEvent_1</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_0lw92ym</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Activity_1bsi5nb</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>
    <bpmn:callActivity id="Activity_193y6v1" name="Realizar visita técnica" calledElement="realizarVisitaTecnica">
      <bpmn:extensionElements>
        <camunda:out source="cobroExtra" target="cobroExtra" />
        <camunda:out source="tipoSolucion" target="tipoSolucion" />
        <camunda:in variables="all" />
        <camunda:out source="descripcionSucedido" target="descripcionVisitaTecnica" />
        <camunda:in source="TicketIdVisita" target="TicketIdVisita" />
        <camunda:out source="RespuestaFSM" target="RespuestaFSM" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0ode434</bpmn:incoming>
      <bpmn:outgoing>Flow_0x1g98b</bpmn:outgoing>
    </bpmn:callActivity>
    <bpmn:businessRuleTask id="Activity_1ll5x9g" name="Clasificar presupuesto" camunda:resultVariable="valor" camunda:decisionRef="clasificarPresupuesto" camunda:mapDecisionResult="singleEntry">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:outputParameter name="valorTotal">${valor+cobroExtra}</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0x1g98b</bpmn:incoming>
      <bpmn:outgoing>Flow_05opd5u</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:parallelGateway id="Gateway_1b3ega7">
      <bpmn:incoming>Flow_05opd5u</bpmn:incoming>
      <bpmn:outgoing>Flow_1cjyg0v</bpmn:outgoing>
      <bpmn:outgoing>Flow_00ca5la</bpmn:outgoing>
    </bpmn:parallelGateway>
    <bpmn:userTask id="Activity_1b7qy8d" name="Generar Factura de Pago" camunda:formRef="facturaPago" camunda:formRefBinding="latest">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="valor">${valor}</camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1cjyg0v</bpmn:incoming>
      <bpmn:outgoing>Flow_11ja9rh</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:serviceTask id="Activity_066js8m" name="Guardar Factura de Pago" camunda:class="com.emsa.workflow.SaveReport">
      <bpmn:incoming>Flow_00ca5la</bpmn:incoming>
      <bpmn:outgoing>Flow_1a6c5pe</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:parallelGateway id="Gateway_0423gd3">
      <bpmn:incoming>Flow_11ja9rh</bpmn:incoming>
      <bpmn:incoming>Flow_1a6c5pe</bpmn:incoming>
      <bpmn:outgoing>Flow_19r7yla</bpmn:outgoing>
    </bpmn:parallelGateway>
    <bpmn:exclusiveGateway id="Gateway_1c06mj0">
      <bpmn:incoming>Flow_19r7yla</bpmn:incoming>
      <bpmn:incoming>Flow_0hvs2zx</bpmn:incoming>
      <bpmn:outgoing>Flow_1p42x5h</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:startEvent id="StartEvent_1" name="Registro Reporte Recibido" camunda:formRef="registroReporteRecibido" camunda:formRefBinding="latest">
      <bpmn:outgoing>Flow_19rilic</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:serviceTask id="Activity_0lw92ym" name="Generar Ticket de Visita en FSM">
      <bpmn:extensionElements>
        <camunda:connector>
          <camunda:inputOutput>
            <camunda:inputParameter name="headers">
              <camunda:map>
                <camunda:entry key="Content-Type">application/json</camunda:entry>
              </camunda:map>
            </camunda:inputParameter>
            <camunda:inputParameter name="method">POST</camunda:inputParameter>
            <camunda:inputParameter name="url">http://127.0.0.1:9095/tickets/crear</camunda:inputParameter>
            <camunda:inputParameter name="payload">{
  "nombre": "${nombre}",
  "domicilio": "${domicilio}",
  "falla": "${falla}"
}</camunda:inputParameter>
            <camunda:outputParameter name="TicketIdVisita">${response}</camunda:outputParameter>
          </camunda:inputOutput>
          <camunda:connectorId>http-connector</camunda:connectorId>
        </camunda:connector>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0onpgmz</bpmn:incoming>
      <bpmn:outgoing>Flow_0ode434</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_0ode434" sourceRef="Activity_0lw92ym" targetRef="Activity_193y6v1" />
    <bpmn:sequenceFlow id="Flow_0x1g98b" sourceRef="Activity_193y6v1" targetRef="Activity_1ll5x9g" />
    <bpmn:sequenceFlow id="Flow_05opd5u" sourceRef="Activity_1ll5x9g" targetRef="Gateway_1b3ega7" />
    <bpmn:sequenceFlow id="Flow_1cjyg0v" sourceRef="Gateway_1b3ega7" targetRef="Activity_1b7qy8d" />
    <bpmn:sequenceFlow id="Flow_00ca5la" sourceRef="Gateway_1b3ega7" targetRef="Activity_066js8m" />
    <bpmn:sequenceFlow id="Flow_11ja9rh" sourceRef="Activity_1b7qy8d" targetRef="Gateway_0423gd3" />
    <bpmn:sequenceFlow id="Flow_1a6c5pe" sourceRef="Activity_066js8m" targetRef="Gateway_0423gd3" />
    <bpmn:sequenceFlow id="Flow_19r7yla" sourceRef="Gateway_0423gd3" targetRef="Gateway_1c06mj0" />
    <bpmn:sequenceFlow id="Flow_0hvs2zx" name="no" sourceRef="Gateway_1g09bxj" targetRef="Gateway_1c06mj0">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${valorPagado &lt; valorTotal}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1p42x5h" sourceRef="Gateway_1c06mj0" targetRef="Activity_10hruzy" />
    <bpmn:sequenceFlow id="Flow_16qvg7p" sourceRef="Activity_10hruzy" targetRef="Activity_CalculateBalance" />
    <bpmn:serviceTask id="Activity_CalculateBalance" name="Calculate Balance" camunda:delegateExpression="${calculateBalance}">
      <bpmn:incoming>Flow_16qvg7p</bpmn:incoming>
      <bpmn:outgoing>Flow_ToResumen</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_ToResumen" sourceRef="Activity_CalculateBalance" targetRef="Activity_Resumen" />
    <bpmn:userTask id="Activity_Resumen" name="Resumen de Pago">
      <bpmn:extensionElements>
        <camunda:formData>
            <camunda:formField id="estadoPago" label="Estado del Pago" type="string" defaultValue="${estadoPago}" />
            <camunda:formField id="saldoCliente" label="Saldo Cliente" type="long" defaultValue="${saldoCliente}" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_ToResumen</bpmn:incoming>
      <bpmn:outgoing>Flow_ToGateway</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_ToGateway" sourceRef="Activity_Resumen" targetRef="Gateway_1g09bxj" />
    <bpmn:sequenceFlow id="Flow_19rilic" sourceRef="StartEvent_1" targetRef="Activity_1bsi5nb" />
    <bpmn:sequenceFlow id="Flow_0onpgmz" sourceRef="Activity_1bsi5nb" targetRef="Activity_0lw92ym" />
    <bpmn:userTask id="Activity_1bsi5nb" name="Agendar Visita Técnica" camunda:formRef="agendamientoVisitaTecnica" camunda:formRefBinding="latest">
      <bpmn:incoming>Flow_19rilic</bpmn:incoming>
      <bpmn:outgoing>Flow_0onpgmz</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_1g09bxj" name="¿pago completo?" default="Flow_0vl9pmj">
      <bpmn:incoming>Flow_ToGateway</bpmn:incoming>
      <bpmn:outgoing>Flow_0vl9pmj</bpmn:outgoing>
      <bpmn:outgoing>Flow_0hvs2zx</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_0vl9pmj" name="si" sourceRef="Gateway_1g09bxj" targetRef="Event_1q1goyy" />
    <bpmn:userTask id="Activity_10hruzy" name="Recibir Pago">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="valorPagado" label="Ingrese el valor que pagó." type="long" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1p42x5h</bpmn:incoming>
      <bpmn:outgoing>Flow_16qvg7p</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:endEvent id="Event_1q1goyy" name="Reporte manejado exitosamente">
      <bpmn:incoming>Flow_0vl9pmj</bpmn:incoming>
    </bpmn:endEvent>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_0y3poa2">
      <bpmndi:BPMNShape id="Participant_1xzh7ng_di" bpmnElement="Participant_1xzh7ng" isHorizontal="true">
        <dc:Bounds x="160" y="79" width="1850" height="721" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_0cgi9xw_di" bpmnElement="Lane_0cgi9xw" isHorizontal="true">
        <dc:Bounds x="190" y="79" width="1820" height="214" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_1r12fda_di" bpmnElement="Lane_1r12fda" isHorizontal="true">
        <dc:Bounds x="190" y="293" width="1820" height="207" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_1ncb5kn_di" bpmnElement="Lane_1ncb5kn" isHorizontal="true">
        <dc:Bounds x="190" y="500" width="1820" height="300" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0tt3y3j_di" bpmnElement="Activity_193y6v1">
        <dc:Bounds x="740" y="360" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_178623r_di" bpmnElement="Activity_1ll5x9g">
        <dc:Bounds x="910" y="360" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0ksmbvw_di" bpmnElement="Gateway_1b3ega7">
        <dc:Bounds x="1085" y="615" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1tr82fp_di" bpmnElement="Activity_1b7qy8d">
        <dc:Bounds x="1200" y="520" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0sd7ihr_di" bpmnElement="Activity_066js8m">
        <dc:Bounds x="1200" y="680" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1no983v_di" bpmnElement="Gateway_0423gd3">
        <dc:Bounds x="1355" y="615" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1c06mj0_di" bpmnElement="Gateway_1c06mj0" isMarkerVisible="true">
        <dc:Bounds x="1445" y="615" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="292" y="172" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="269" y="215" width="84" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1xgmm5o_di" bpmnElement="Activity_0lw92ym">
        <dc:Bounds x="570" y="150" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1ujopyx_di" bpmnElement="Activity_1bsi5nb">
        <dc:Bounds x="420" y="150" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1g09bxj_di" bpmnElement="Gateway_1g09bxj" isMarkerVisible="true">
        <dc:Bounds x="1795" y="615" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1778" y="672" width="85" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1tzllxz_di" bpmnElement="Activity_10hruzy">
        <dc:Bounds x="1600" y="600" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1q1goyy_di" bpmnElement="Event_1q1goyy">
        <dc:Bounds x="1942" y="622" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1927" y="665" width="66" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0ode434_di" bpmnElement="Flow_0ode434">
        <di:waypoint x="670" y="190" />
        <di:waypoint x="710" y="190" />
        <di:waypoint x="710" y="400" />
        <di:waypoint x="740" y="400" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0x1g98b_di" bpmnElement="Flow_0x1g98b">
        <di:waypoint x="840" y="400" />
        <di:waypoint x="910" y="400" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_05opd5u_di" bpmnElement="Flow_05opd5u">
        <di:waypoint x="1010" y="400" />
        <di:waypoint x="1050" y="400" />
        <di:waypoint x="1050" y="640" />
        <di:waypoint x="1085" y="640" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1cjyg0v_di" bpmnElement="Flow_1cjyg0v">
        <di:waypoint x="1110" y="615" />
        <di:waypoint x="1110" y="560" />
        <di:waypoint x="1200" y="560" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_00ca5la_di" bpmnElement="Flow_00ca5la">
        <di:waypoint x="1110" y="665" />
        <di:waypoint x="1110" y="720" />
        <di:waypoint x="1200" y="720" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_11ja9rh_di" bpmnElement="Flow_11ja9rh">
        <di:waypoint x="1300" y="560" />
        <di:waypoint x="1380" y="560" />
        <di:waypoint x="1380" y="615" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1a6c5pe_di" bpmnElement="Flow_1a6c5pe">
        <di:waypoint x="1300" y="720" />
        <di:waypoint x="1380" y="720" />
        <di:waypoint x="1380" y="665" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_19r7yla_di" bpmnElement="Flow_19r7yla">
        <di:waypoint x="1405" y="640" />
        <di:waypoint x="1445" y="640" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0hvs2zx_di" bpmnElement="Flow_0hvs2zx">
        <di:waypoint x="1820" y="615" />
        <di:waypoint x="1820" y="540" />
        <di:waypoint x="1470" y="540" />
        <di:waypoint x="1470" y="615" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1643" y="522" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1p42x5h_di" bpmnElement="Flow_1p42x5h">
        <di:waypoint x="1495" y="640" />
        <di:waypoint x="1600" y="640" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_16qvg7p_di" bpmnElement="Flow_16qvg7p">
        <di:waypoint x="1700" y="640" />
        <di:waypoint x="1795" y="640" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_19rilic_di" bpmnElement="Flow_19rilic">
        <di:waypoint x="328" y="190" />
        <di:waypoint x="420" y="190" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0onpgmz_di" bpmnElement="Flow_0onpgmz">
        <di:waypoint x="520" y="190" />
        <di:waypoint x="570" y="190" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0vl9pmj_di" bpmnElement="Flow_0vl9pmj">
        <di:waypoint x="1845" y="640" />
        <di:waypoint x="1942" y="640" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1858" y="622" width="9" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
